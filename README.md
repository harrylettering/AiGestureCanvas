# AiGestureCanvas
手势画布（摄像头作为 UI 的手势绘图应用）

## 项目概述
基于 MediaPipe Hand Landmarker 的手势绘图应用：使用摄像头获取手部关键点，通过“捏合”手势控制绘制、撤销与清空。页面将电脑摄像头视频作为全屏背景，画布叠加其上，实现直观的“摄像头即 UI”。

## 主要特性
- 摄像头全屏背景，画布叠加显示绘制效果。
- 手势控制：
  - 食指捏合短按：切换绘制开关（开始/停止绘制）。
  - 食指捏合长按（约>1秒）：清空画布与历史笔画。
  - 中指捏合短按：撤销上一笔（仅在非绘制状态触发，避免干扰当前笔画）。
- 颜色与粗细：预设颜色（含白色）与自定义取色器；细/中/粗三档。
- 状态显示与联动：当前颜色方块与粗细文本、按钮选中态实时同步。
- 镜像预览开关：同时镜像视频与画布坐标，确保视觉与绘制方向一致。
- 灵敏度调节：支持 1–5 档，影响捏合阈值、帧稳定与平滑。
- 撤销栈与重绘：记录每笔的颜色、粗细与点序列，支持撤销与窗口缩放后重绘。

## 快速开始
1. 安装依赖：
   ```bash
   npm install
   ```
2. 启动开发服务：
   ```bash
   npm run dev
   ```
3. 浏览器打开 `http://localhost:5173/`，点击“开启摄像头”，授予摄像头权限即可使用。

## 手势与交互
- 食指捏合短按：开始/停止绘制（形成一笔）。
- 食指捏合长按（约>1秒）：清空画布与历史笔画。
- 中指捏合短按：撤销最近完成的一笔（当前未在绘制时触发）。
- 提示文案位于左下角，含手势说明与清空提示。

## 工具栏说明
- 开启摄像头：加载与启动 MediaPipe 模型后打开视频预览。
- 颜色：提供黑/红/蓝/绿/白预设，支持自定义取色器；选中后高亮并同步当前颜色显示。
- 粗细：细/中/粗三档，当前粗细以文本显示。
- 灵敏度：1–5 档，影响捏合进入/退出阈值、帧稳定与 EMA 平滑强度。
- 镜像预览：勾选后视频 `scaleX(-1)` 且画布坐标水平镜像。
- 清空：清除画布与历史笔画。
- 保存PNG：将当前画布导出为 PNG 文件。

## 稳定性与灵敏度
灵敏度滑块会同时影响以下参数（详见 `main.js` 中 `applySensitivity`）：
- 进入捏合阈值系数 `ON_COEF` 与退出阈值系数 `OFF_COEF`（相对于掌宽）。
- 捏合距离指数平滑系数 `PINCH_EMA_ALPHA`。
- 连续满足帧数 `ENTER_FRAMES` / `EXIT_FRAMES`（帧稳定）。

同时使用掌宽（食指与小指掌指关节间距）作为动态尺度，提升不同距离/画面尺寸下的稳定性。

## 模型与 WASM 资源准备
前端会优先本地加载模型与 WASM，失败再回退到官方 CDN：
- 模型文件：`public/models/hand_landmarker.task`
  - 具体下载方式见 `public/models/README.txt`。
- WASM 文件（可选，本地优先）：`public/mediapipe/wasm/vision_wasm_internal.js` 等文件。
  - 若未提供，将自动使用 `jsDelivr` 的远程 WASM。

目录结构（关键文件）：
```
├── index.html
├── main.js
├── style.css
└── public/
    ├── mediapipe/wasm/               # 可选，本地 WASM（存在则优先）
    └── models/hand_landmarker.task   # 手部关键点模型（本地优先）
```

## 常见问题
- 摄像头无法开启：检查浏览器权限及 HTTPS/localhost；或是否存在隐私权限限制。
- 模型加载失败：按 `public/models/README.txt` 准备 `hand_landmarker.task`；或确认网络可访问 CDN。
- 方向不一致：开启“镜像预览”，将视频与画布坐标同时镜像以保持一致。
- 快速滑动出现断点：已通过“平滑前后点连接”修复，若仍有问题可提高灵敏度或降低笔粗细。

## 关键配置（可根据需要调整）
- `LONG_PINCH_MS`（默认 800ms）：判定长捏合清空的时间阈值。
- `numHands`（默认 1）：模型检测的手数量（提高会影响性能）。
- 颜色/粗细预设：可在 `index.html` 的工具栏中添加或修改。

## 隐私与权限
应用仅在本地浏览器中处理视频流与手势，不上传数据；使用时需授予摄像头访问权限。

## 许可证
未指定许可证；仅用于演示与个人使用。如需开源发布，请补充相应协议。
